<!DOCTYPE html>
<html lang="no" class="h-full bg-black">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Styrt Side</title>
    <!-- Importerer Tailwind CSS for rask og pen styling --><script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Importerer QR-kode biblioteket --><script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- Importerer "Inter" fonten, standard for moderne UI --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for karusell-ikoner (selv om de ikke er i bruk, er det i originalkoden) --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" xintegrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Roboto-font fra karusellen --><link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">


    <style>
        /* === Overganger === */
        .scene {
            position: fixed; 
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden; 
            background-color: #000;
            
            opacity: 0;
            pointer-events: none; /* Kan ikke klikkes/interageres med når usynlig */
            
            transition: opacity 0.4s ease-in-out; 
        }
        
        .scene.active {
            opacity: 1;
            pointer-events: auto; 
        }
        /* ================================================= */

        /* Sørger for at videoer og iframes fyller scenen */
        .scene video,
        .scene iframe {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Dekker hele flaten, kan beskjære kantene */
        }
        /* Ny klasse for å 'kutte' toppen av videoen */
        .video-crop-top {
            object-position: bottom; /* Kutter toppen */
        }

        /* Setter Inter som hovedfont for hele appen */
        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
        }

        /* Speil videoen horisontalt */
        .video-mirrored {
            transform: scaleX(-1);
        }

        /* === NEDTELLINGSSIDE STYLING === */
        .scene.countdown-video-scene {
             display: flex; 
             flex-direction: column;
             justify-content: center;
             align-items: center; 
             padding-bottom: 10vh;
        }
        
        .countdown-video-scene video {
            width: auto; 
            height: 50vh; 
            max-width: 100vw;
            object-fit: contain; 
        }
        
        .countdown-text-box h2 {
            font-size: 3.5rem;
            font-weight: 500;
            color: #FFFFFF;
            animation: pulse-text-green 2s infinite; 
        }
        
        /* Animasjon for pulserende grønn TEKST */
        @keyframes pulse-text-green {
            0% {
                opacity: 0.7;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            100% {
                opacity: 0.7;
                transform: scale(1);
            }
        }
        
        /* KLASSE for å bruke animasjonen på rapporten */
        .animate-pulse-green-report {
            animation: pulse-text-green 2s infinite;
        }

        /* === "GO!" ANIMASJON === */
        .scene-go {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .go-text {
            font-size: 20rem; 
            font-weight: 700;
            color: #2ecc71; 
            text-shadow: 0 0 50px rgba(46, 204, 113, 0.7);
            
            animation: none;
        }
        
        .scene-go.active .go-text {
            animation: zoom-in-out 1.5s ease-in-out;
        }

        @keyframes zoom-in-out {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* === RAPPORT-SIDE (SCENE 18) STYLING === */
        
        /* Aurora-glød-effekter for bakgrunnen */
        .aurora-blur {
            filter: blur(100px);
        }
        .aurora-shape-1 {
            position: absolute;
            top: 5vh;
            left: 10vw;
            width: 30vw;
            height: 30vw;
            background-color: #0077ff; /* Blå */
            border-radius: 50%;
            opacity: 0.3;
            animation: drift 20s infinite alternate ease-in-out;
        }
        .aurora-shape-2 {
            position: absolute;
            bottom: 10vh;
            right: 15vw;
            width: 40vw;
            height: 40vw;
            background-color: #2ecc71; /* Grønn */
            border-radius: 50%;
            opacity: 0.25;
            animation: drift 25s infinite alternate ease-in-out;
        }
        
        /* NY: Lilla form for oversikt-scenen */
        .aurora-shape-3 {
            position: absolute;
            top: 20vh;
            right: 5vw;
            width: 35vw;
            height: 35vw;
            background-color: #9b59b6; /* Lilla */
            border-radius: 50%;
            opacity: 0.2;
            animation: drift 18s infinite alternate ease-in-out;
        }
        
        @keyframes drift {
            0% {
                transform: translateX(0) translateY(0);
            }
            100% {
                transform: translateX(50px) translateY(30px) scale(1.1);
            }
        }
        
        /* FIKS: Plasser rapporten høyere opp */
        #scene-18 {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Starter fra toppen */
            padding-top: 15vh; 
        }
        
        /* Sentrering av Real Age og Fitness Age tallene */
        #report-real-age,
        #report-new-age {
            grid-area: 1 / 1; /* Plasserer begge i samme celle (rad 1, kol 1) */
            transition: transform 0.7s cubic-bezier(0.23, 1, 0.32, 1), opacity 0.5s ease;
        }

        /* Boksene som fader inn */
        .report-box {
            transition: transform 0.6s ease-out, opacity 0.6s ease-out;
        }
        
        /* Teksten i boksene */
        .report-box p {
            transition: opacity 0.5s ease-in;
        }

        /* === KARUSELL CSS START === */
        :root {
            --color-brand-accent: rgb(47, 124, 83);
            --color-brand-white: #FFFFFF;
            --color-grey-lightest: #D9D9D9;
            --color-grey-light: #A6A6A6;
            --font-primary: 'Roboto', sans-serif;
            --font-weight-normal: 400;
        }

        /* Overstyrer body-font for karusell-elementer, men lar Inter være default */
        .reports-section, .report-modal-overlay {
            font-family: var(--font-primary);
        }

        body.modal-open {
            overflow: hidden;
        }

        .reports-section h2, .reports-section h3, .reports-section h4, .reports-section p {
            margin: 0;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .text-accent {
            color: var(--color-brand-accent);
        }
        
        .reports-section {
            padding: 60px 0;
            background-color: transparent; /* Endret fra #000 */
            position: absolute; /* Plassert i bunnen av scenen */
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 10; /* Samme nivå som QR-boksen */
            /* margin-top: 100vh; (Fjernet) */
        }
        
        .divider {
            width: 80px;
            height: 3px;
            background-color: var(--color-brand-accent);
            margin: 0 auto 2em;
            border-radius: 2px;
        }
        
        .reports-section h2 {
            font-family: 'Roboto', sans-serif;
            font-weight: 300;
            font-size: 30px;
            color: var(--color-brand-white);
            text-align: center;
            margin-bottom: 2em;
        }

        /* Стили карусели */
        .report-carousel-container {
            width: 100%;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .report-carousel-container::-webkit-scrollbar {
            display: none;
        }

        .report-carousel-track {
            display: flex;
            width: fit-content;
            padding: 0 20px;
        }

        .report-card {
            width: 60vw;
            max-width: 220px;
            flex-shrink: 0;
            padding: 0 10px;
            text-align: center;
            cursor: pointer;
            scroll-snap-align: center;
        }

        @media (min-width: 1024px) {
            .report-carousel-container {
                max-width: 1000px;
                margin: 0 auto;
                overflow: hidden;
                -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
                mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
            }
            .report-carousel-track {
                width: calc(250px * 10); /* (card width + padding) * 10 items (var 8) */
                padding: 0;
                animation: scroll-reports 50s linear infinite; /* 40s -> 50s for 10 items */
            }
            .report-carousel-track:hover {
                animation-play-state: paused;
            }
            @keyframes scroll-reports {
                from { transform: translateX(0); }
                to { transform: translateX(-50%); }
            }
            .report-card {
                width: 220px;
                padding: 0 15px;
            }
        }
        
        .report-card img {
            width: 100%;
            height: 283px;
            object-fit: cover;
            object-position: center;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            margin-bottom: 1.5em;
            transition: transform 0.3s ease;
        }

        .report-card:hover img {
            transform: scale(1.05);
        }

        .report-title {
            font-size: 1rem;
            margin-bottom: 0.4em;
            font-weight: var(--font-weight-normal);
            color: var(--color-brand-white);
        }

        .report-description {
            font-size: 0.85rem;
            color: var(--color-grey-light);
        }
        
        /* Стили модального окна */
        .report-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            z-index: 2000; display: flex; align-items: center; justify-content: center;
            opacity: 0; visibility: hidden; transition: opacity 0.3s ease;
        }
        .report-modal-overlay.is-visible { opacity: 1; visibility: visible; }

        .report-modal-content {
            background-color: rgba(26, 26, 26, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px; border-radius: 12px;
            display: grid;
            grid-template-columns: 1fr 1fr; 
            gap: 30px;
            width: 90%; max-width: 900px; max-height: 90vh;
            overflow-y: auto; position: relative;
            transform: scale(0.95); transition: transform 0.3s ease;
        }
        .report-modal-overlay.is-visible .report-modal-content { transform: scale(1); }
        
        @media (max-width: 768px) {
            .report-modal-content {
                grid-template-columns: 1fr;
                padding: 20px;
            }
             .report-modal-text-container h3 {
                font-size: 1.5rem;
            }
        }

        .report-modal-image-container img { width: 100%; border-radius: 8px; }
        .report-modal-text-container h3 { font-size: 1.8rem; color: var(--color-brand-accent); }
        .report-modal-text-container h4 {
            margin-top: 1.5em; margin-bottom: 0.5em; font-size: 1.2rem;
            color: var(--color-brand-white); border-bottom: 1px solid var(--color-brand-accent);
            padding-bottom: 0.3em;
        }
        .report-modal-text-container p { font-size: 1rem; line-height: 1.7; color: var(--color-grey-lightest); }
        .report-modal-text-container ul { list-style: none; padding: 0; margin: 0; }
        .report-modal-text-container ul li {
            background-color: rgba(255,255,255,0.05); padding: 8px 12px;
            border-radius: 4px; margin-bottom: 8px; font-size: 0.9rem;
        }

        .close-report-modal {
            position: absolute; 
            top: 10px; 
            right: 10px; 
            width: 40px;
            height: 40px;
            background-color: rgba(0,0,0,0.5);
            border-radius: 50%;
            border: none; 
            color: #FFFFFF; 
            font-size: 1.5rem; 
            line-height: 40px;
            text-align: center;
            cursor: pointer; 
            z-index: 10;
            transition: transform 0.2s ease;
        }
        .close-report-modal:hover { 
            transform: scale(1.1);
        }
        /* === KARUSELL CSS SLUTT === */
    </style>
</head>
<body class="h-full text-white">

    <!-- =========== SCENE 0: SCREENSAVER (Default) =========== --><div id="scene-0" class="scene">
        <!-- Video (Nå som bakgrunn) --><video src="https://storage.googleapis.com/intro_alphatek/videoer/Tests%20Presentation.mp4" 
               autoplay loop muted playsinline
               class="absolute top-0 left-0 w-full h-full object-cover z-0"></video>

        <!-- DISKRET KANAL-ID VISNING --><div id="channel-id-display-top" 
             class="absolute top-4 right-4 text-xs font-mono text-emerald-400 bg-black/50 px-3 py-1 rounded-lg z-20 opacity-70">
            Laster...
        </div>

        <!-- ENDRING: La til items-start for å hindre at boksen strekker seg --><div class="absolute inset-0 flex items-start justify-center z-10 p-8 pt-64">
            <!-- Selve "Frosted Glass" boksen --><div class="bg-white/10 backdrop-blur-lg rounded-2xl shadow-xl border border-white/10 p-8 max-w-[15rem] w-full text-center">
                
                <!-- ENDRING: Fjernet w-48 h-48, la til w-full aspect-square for å tilpasse seg forelderen --><div id="dynamic-qr-code" 
                     class="w-full aspect-square mx-auto rounded-2xl border-8 border-green-600 flex items-center justify-center bg-white p-2 shadow-lg">
                </div>
                
                <!-- Tekst under QR-koden --><h2 class="text-3xl font-medium text-white mt-6">
                    Scan to get started
                </h2>
            </div>
        </div>
        
        <!-- NYTT: Svart fade fra bunnen for å forbedre kontrast for karusellen --><div class="absolute bottom-0 left-0 w-full h-1/3 bg-gradient-to-t from-black/80 to-transparent z-5"></div>

        <!-- 
        ===========================================
        NYTT INNHOLD: RAPPORT-KARUSELL (Flyttet inn i scene-0)
        <!-- ===========================================
        --><section id="reports" class="reports-section">
            <div class="container">
                <!-- <div class="divider"></div> (Fjernet etter ønske) --><!-- <h2 class="section-title">Equip your medical team with reports to track rehab, return to play, and performance</h2> (Fjernet etter ønske) --></div>
            <div class="report-carousel-container">
                <div class="report-carousel-track">
                    <div class="report-card" data-report-id="return-to-sport"><img src="https://storage.googleapis.com/intro_alphatek/reports/Return%20to%20play.png" alt="Return to Sport Report"><h4 class="report-title text-accent">Return to Sport</h4><p class="report-description">Comprehensive readiness evaluation.</p></div>
                    <div class="report-card" data-report-id="performance"><img src="https://storage.googleapis.com/intro_alphatek/reports/Handball.png" alt="Performance Report"><h4 class="report-title text-accent">Performance Report</h4><p class="report-description">For any athlete in any sport.</p></div>
                    <div class="report-card" data-report-id="shoulder-screening"><img src="https://storage.googleapis.com/intro_alphatek/reports/shoulder.png" alt="Shoulder Screening Report"><h4 class="report-title text-accent">Shoulder Screening</h4><p class="report-description">Assess readiness for overhead loading.</p></div>
                    <div class="report-card" data-report-id="rehab-initial"><img src="https://storage.googleapis.com/intro_alphatek/reports/PT%20basic.png" alt="Phase 1 & 2 Rehab Report"><h4 class="report-title text-accent">Phase 1 & 2 Rehab</h4><p class="report-description">Gentle, early-stage progress tracking.</p></div>
                    <!-- NYTT KORT LAGT TIL --><div class="report-card" data-report-id="senior-wellness"><img src="https://storage.googleapis.com/intro_alphatek/reports/senior%20raport.png" alt="Senior Fitness Test"><h4 class="report-title text-accent">Senior Fitness Test</h4><p class="report-description">For the active senior.</p></div>
                    
                    <!-- Duplicates for infinite scroll -->
                    <div class="report-card" data-report-id="return-to-sport"><img src="https://storage.googleapis.com/intro_alphatek/reports/Return%20to%20play.png" alt="Return to Sport Report"><h4 class="report-title text-accent">Return to Sport</h4><p class="report-description">Comprehensive readiness evaluation.</p></div>
                    <div class="report-card" data-report-id="performance"><img src="https://storage.googleapis.com/intro_alphatek/reports/Handball.png" alt="Performance Report"><h4 class="report-title text-accent">Performance Report</h4><p class="report-description">For any athlete in any sport.</p></div>
                    <div class="report-card" data-report-id="shoulder-screening"><img src="https://storage.googleapis.com/intro_alphatek/reports/shoulder.png" alt="Shoulder Screening Report"><h4 class="report-title text-accent">Shoulder Screening</h4><p class="report-description">Assess readiness for overhead loading.</p></div>
                    <div class="report-card" data-report-id="rehab-initial"><img src="https://storage.googleapis.com/intro_alphatek/reports/PT%20basic.png" alt="Phase 1 & 2 Rehab Report"><h4 class="report-title text-accent">Phase 1 & 2 Rehab</h4><p class="report-description">Gentle, early-stage progress tracking.</p></div>
                    <!-- NYTT KORT LAGT TIL (DUPLIKAT) --><div class="report-card" data-report-id="senior-wellness"><img src="https://storage.googleapis.com/intro_alphatek/reports/senior%20raport.png" alt="Senior Fitness Test"><h4 class="report-title text-accent">Senior Fitness Test</h4><p class="report-description">For the active senior.</p></div>
                </div>
            </div>
        </section>

        <!-- NYTT INNHOLD: MODAL FOR KARUSELL (Flyttet inn i scene-0) --><div class="report-modal-overlay" id="report-modal-overlay">
            <div class="report-modal-content">
                <button class="close-report-modal" aria-label="Close report">&times;</button>
                <div class="report-modal-image-container">
                    <img id="modal-report-image" src="" alt="Enlarged report">
                </div>
                <div class="report-modal-text-container">
                    <h3 id="modal-report-title"></h3>
                    <p id="modal-report-explanation"></p>
                    <h4>Test Battery</h4>
                    <ul id="modal-report-tests"></ul>
                </div>
            </div>
        </div>
        <!-- 
        ===========================================
        SLUTT PÅ FLYTTET INNHOLD
        ===========================================
        --></div>
    
    <!-- =========== SCENE 1: FITNESS AGE OVERSIKT =========== --><div id="scene-1" class="scene">
        <!-- Hele scenen er nå en scrollbar kolonne --><div class="flex flex-col h-full overflow-y-auto">
            
            <!-- Topp-seksjon (Header) --><div class="h-[50vh] relative overflow-hidden flex-shrink-0">
                <!-- Bakgrunnsvideo --><video id="scene-1-video" src="https://storage.googleapis.com/intro_alphatek/videoer/Age%20Test%202%20-%20NO%20TEXT%20ON%20-%20Alphatatek%20-%204k%20.mp4" 
                       autoplay loop muted playsinline 
                       class="absolute top-0 left-0 w-full h-full object-cover z-0"></video>
                
                <!-- Fade fra bunnen av videoen --><div class="absolute bottom-0 left-0 w-full h-24 bg-gradient-to-t from-black to-transparent z-10"></div>
                
                <!-- "Ola Nordman" Login Ikon --><div class="absolute top-6 right-8 flex items-center space-x-3 z-20">
                    <span class="text-white text-lg font-medium">Ola Nordman</span>
                    <div class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                        </svg>
                    </div>
                </div>

                <!-- Teksten i en "Frosted Glass"-boks --><div class="absolute inset-0 flex flex-col items-center justify-center z-10 text-center p-8">
                    
                    <div class="bg-white/10 backdrop-blur-lg rounded-2xl shadow-xl p-8">
                        <h1 class="text-3xl font-semibold opacity-80 mb-1">Fitness Age</h1>
                        <div class="flex items-end justify-center">
                            <span class="text-9xl font-bold text-green-400">32</span>
                            <span class="text-4xl font-bold text-green-400 ml-2 pb-2"><sup>-2</sup></span>
                        </div>
                        <p class="text-xl text-green-200 mt-2">
                            An improvement of 2 years since last test!
                        </p>
                    </div>
                </div>
            </div>

            <!-- Bunn-seksjon (Testliste) --><div class="bg-black p-6 flex-grow relative overflow-hidden">
                <div class="aurora-blur absolute inset-0 overflow-hidden z-0">
                    <div class="aurora-shape-1" style="opacity: 0.2;"></div>
                    <div class="aurora-shape-2" style="opacity: 0.15;"></div>
                    <div class="aurora-shape-3"></div>
                </div>
                <h2 class="text-3xl font-bold mb-5 px-2 relative z-10">Your Tests</h2>
                <div class="space-y-4 max-w-4xl mx-auto relative z-10"> 
                    <div class="rounded-2xl shadow-xl border border-white/10 overflow-hidden flex h-48">
                        <div class="flex-1 p-6 flex flex-col justify-between bg-gradient-to-r from-white/10 to-black/80 backdrop-blur-md">
                            <div>
                                <h3 class="text-2xl font-semibold text-blue-300">Balance Age</h3>
                                <p class="text-sm text-white/70 mt-1">Great progress on stability!</p>
                            </div>
                            <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3 text-center mt-4 self-start">
                                <div class="flex items-baseline justify-center space-x-1">
                                    <span class="text-3xl font-bold text-blue-300">34</span>
                                    <span class="text-xl font-bold text-green-400"><sup>(-1)</sup></span>
                                </div>
                                <div class="text-sm opacity-80">Years</div>
                            </div>
                        </div>
                        <div class="w-1/3 flex items-center justify-center p-4 bg-black/80">
                            <img src="https://storage.googleapis.com/intro_alphatek/FitnessAgeBilder/Balance.png" alt="Balance" class="w-full h-full object-contain">
                        </div>
                    </div>
                    <div class="rounded-2xl shadow-xl border border-white/10 overflow-hidden flex h-48">
                        <div class="flex-1 p-6 flex flex-col justify-between bg-gradient-to-r from-white/10 to-black/80 backdrop-blur-md">
                            <div>
                                <h3 class="text-2xl font-semibold text-green-300">Functional Age</h3>
                                <p class="text-sm text-white/70 mt-1">Excellent functional improvement!</p>
                            </div>
                            <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3 text-center mt-4 self-start">
                                <div class="flex items-baseline justify-center space-x-1">
                                    <span class="text-3xl font-bold text-green-300">31</span>
                                    <span class="text-xl font-bold text-green-400"><sup>(-3)</sup></span>
                                </div>
                                <div class="text-sm opacity-80">Years</div>
                            </div>
                        </div>
                        <div class="w-1/3 flex items-center justify-center p-4 bg-black/80">
                            <img src="https://storage.googleapis.com/intro_alphatek/FitnessAgeBilder/Jump.png" alt="Jump" class="w-full h-full object-contain">
                        </div>
                    </div>
                    <div class="rounded-2xl shadow-xl border border-white/10 overflow-hidden flex h-48">
                        <div class="flex-1 p-6 flex flex-col justify-between bg-gradient-to-r from-white/10 to-black/80 backdrop-blur-md">
                            <div>
                                <h3 class="text-2xl font-semibold text-purple-300">Strength Age</h3>
                                <p class="text-sm text-white/70 mt-1">Focus on strength this week.</p>
                            </div>
                            <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3 text-center mt-4 self-start">
                                <div class="flex items-baseline justify-center space-x-1">
                                    <span class="text-3xl font-bold text-purple-300">33</span>
                                    <span class="text-xl font-bold text-red-400"><sup>(+1)</sup></span>
                                </div>
                                <div class="text-sm opacity-80">Years</div>
                            </div>
                        </div>
                        <div class="w-1/3 flex items-center justify-center p-4 bg-black/80">
                            <img src="https://storage.googleapis.com/intro_alphatek/FitnessAgeBilder/Pull.png" alt="Pull" class="w-full h-full object-contain">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- =========== BALANSE VENSTRE FLYT =========== --><div id="scene-2" class="scene">
        <video id="video-bal-left" src="https://storage.googleapis.com/files_webpage/Instruction%20video%20(demo)/Balance%20left.mp4" autoplay loop muted playsinline class="video-crop-top"></video>
        <div class="absolute inset-0 flex items-start justify-center z-10 p-4 pt-[30vh]">
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl shadow-xl border border-white/10 p-8 max-w-lg w-full">
                <h2 class="text-5xl font-medium text-blue-300 mb-6 text-center">Balance Test: Right</h2>
                <ul class="text-2xl font-medium text-white/90 space-y-3 list-disc list-inside">
                    <li>Lift foot 10 cm.</li>
                    <li>Keep arms by your side.</li>
                    <li>Look straight ahead.</li>
                </ul>
            </div>
        </div>
    </div>
    <div id="scene-countdown-1" class="scene countdown-video-scene">
        <div class="countdown-text-box mb-12"> <h2>Test starts in...</h2> </div>
        <video id="video-counter-1" src="https://storage.googleapis.com/intro_alphatek/FitnessAgeBilder/5%20second%20beep%20countdown%20intro%20Short.mp4" autoplay muted playsinline></video>
    </div>
    <div id="scene-go-1" class="scene scene-go"> <div class="go-text">GO!</div> </div>

    <!-- =========== BALANSE HØYRE FLYT =========== --><div id="scene-6" class="scene">
        <video id="video-bal-right" src="https://storage.googleapis.com/files_webpage/Instruction%20video%20(demo)/Balance%20left.mp4" autoplay loop muted playsinline class="video-crop-top video-mirrored"></video>
        <div class="absolute inset-0 flex items-start justify-center z-10 p-4 pt-[30vh]">
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl shadow-xl border border-white/10 p-8 max-w-lg w-full">
                <h2 class="text-5xl font-medium text-blue-300 mb-6 text-center">Balance Test: Left</h2>
                <ul class="text-2xl font-medium text-white/90 space-y-3 list-disc list-inside">
                    <li>Lift foot 10 cm.</li>
                    <li>Keep arms by your side.</li>
                    <li>Look straight ahead.</li>
                </ul>
            </div>
        </div>
    </div>
    <div id="scene-countdown-bal-right" class="scene countdown-video-scene">
        <div class="countdown-text-box mb-12"> <h2>Test starts in...</h2> </div>
        <video id="video-counter-bal-right" src="https://storage.googleapis.com/intro_alphatek/FitnessAgeBilder/5%20second%20beep%20countdown%20intro%20Short.mp4" autoplay muted playsinline></video>
    </div>
    <div id="scene-go-bal-right" class="scene scene-go"> <div class="go-text">GO!</div> </div>

    <!-- =========== JUMP FLYT =========== --><div id="scene-10" class="scene">
        <video id="video-jump" src="https://storage.googleapis.com/files_webpage/Instruction%20video%20(demo)/Jump.mp4" autoplay loop muted playsinline class="video-crop-top"></video>
        <div class="absolute inset-0 flex items-start justify-center z-10 p-4 pt-[30vh]">
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl shadow-xl border border-white/10 p-8 max-w-lg w-full">
                <h2 class="text-5xl font-medium text-green-300 mb-6 text-center">Squat Jump</h2>
                <ul class="text-2xl font-medium text-white/90 space-y-3 list-disc list-inside">
                    <li>Squat down (back straight).</li>
                    <li>Jump up explosively.</li>
                    <li>Land softly.</li>
                </ul>
            </div>
        </div>
    </div>
    <div id="scene-countdown-2" class="scene countdown-video-scene">
        <div class="countdown-text-box mb-12"> <h2>Test starts in...</h2> </div>
        <video id="video-counter-2" src="https://storage.googleapis.com/intro_alphatek/FitnessAgeBilder/5%20second%20beep%20countdown%20intro%20Short.mp4" autoplay muted playsinline></video>
    </div>
    <div id="scene-go-2" class="scene scene-go"> <div class="go-text">GO!</div> </div>

    <!-- =========== PULL FLYT =========== --><div id="scene-14" class="scene">
        <video id="video-pull" src="https://storage.googleapis.com/files_webpage/Instruction%20video%20(demo)/Pull.mp4" autoplay loop muted playsinline class="video-crop-top"></video>
        <div class="absolute inset-0 flex items-start justify-center z-10 p-4 pt-[30vh]">
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl shadow-xl border border-white/10 p-8 max-w-lg w-full">
                <h2 class="text-5xl font-medium text-purple-300 mb-6 text-center">Isometric Midthigh Pull</h2>
                <ul class="text-2xl font-medium text-white/90 space-y-3 list-disc list-inside">
                    <li>Grasp bar, stand tall.</li>
                    <li>Back straight, arms extended.</li>
                    <li>Pull as hard as you can.</li>
                </ul>
            </div>
        </div>
    </div>
    <div id="scene-countdown-3" class="scene countdown-video-scene">
        <div class="countdown-text-box mb-12"> <h2>Test starts in...</h2> </div>
        <video id="video-counter-3" src="https://storage.googleapis.com/intro_alphatek/FitnessAgeBilder/5%20second%20beep%20countdown%20intro%20Short.mp4" autoplay muted playsinline></video>
    </div>
    <div id="scene-go-3" class="scene scene-go"> <div class="go-text">GO!</div> </div>

    <!-- =========== FINAL REPORT =========== --><div id="scene-18" class="scene bg-black p-8">
        <div class="aurora-blur absolute inset-0 overflow-hidden z-0">
            <div class="aurora-shape-1"></div>
            <div class="aurora-shape-2"></div>
        </div>
        <div id="report-age-container" class="w-full max-w-lg z-10 grid">
            <div id="report-real-age" class="text-white text-center">
                <span class="text-5xl font-medium text-gray-400">Real Age</span>
                <span class="block text-[10rem] font-bold leading-none mt-2">35</span>
            </div>
            <div id="report-new-age" class="text-green-400 opacity-0 text-center">
                <span class="text-5xl font-medium text-green-400">Fitness Age</span>
                <span class="block text-[10rem] font-bold leading-none mt-2">32</span>
            </div>
        </div>
        <div class="report-boxes-container max-w-2xl w-full grid grid-cols-1 gap-5 mt-12 z-10"> 
            <div id="report-box-1" class="report-box bg-white/5 backdrop-blur-md rounded-2xl shadow-xl p-6 flex justify-between items-center border border-white/10 opacity-0 translate-y-5">
                <div class="flex flex-col">
                    <h2 class="text-3xl font-semibold text-blue-300">Balance Age</h2>
                    <p id="report-text-1" class="text-lg text-white/80 mt-1 opacity-0">1 year improvement</p>
                </div>
                <div class="flex items-end">
                    <span class="text-5xl font-bold text-white">34</span>
                    <span class="text-2xl font-bold text-green-400 ml-1 pb-1"><sup>(-1)</sup></span>
                </div>
            </div>
            <div id="report-box-2" class="report-box bg-white/5 backdrop-blur-md rounded-2xl shadow-xl p-6 flex justify-between items-center border border-white/10 opacity-0 translate-y-5">
                <div class="flex flex-col">
                    <h2 class="text-3xl font-semibold text-green-300">Functional Age</h2>
                    <p id="report-text-2" class="text-lg text-white/80 mt-1 opacity-0">Excellent 3 year improvement</p>
                </div>
                <div class="flex items-end">
                    <span class="text-5xl font-bold text-white">31</span>
                    <span class="text-2xl font-bold text-green-400 ml-1 pb-1"><sup>(-3)</sup></span>
                </div>
            </div>
            <div id="report-box-3" class="report-box bg-white/5 backdrop-blur-md rounded-2xl shadow-xl p-6 flex justify-between items-center border border-white/10 opacity-0 translate-y-5">
                <div class="flex flex-col">
                    <h2 class="text-3xl font-semibold text-purple-300">Strength Age</h2>
                    <p id="report-text-3" class="text-lg text-white/80 mt-1 opacity-0">Needs focus (+1 year)</p>
                </div>
                <div class="flex items-end">
                    <span class="text-5xl font-bold text-white">33</span>
                    <span class="text-2xl font-bold text-red-400 ml-1 pb-1"><sup>(+1)</sup></span>
                </div>
            </div>
        </div>
        <div id="report-final-message" class="text-center mt-12 opacity-0 transition-opacity duration-1000 z-10">
            <h2 class="text-5xl font-semibold text-green-400 animate-pulse-green-report">
                You are 3 years younger!
            </h2>
        </div>
    </div>
    
    <!-- =========== IFRAME CONTAINER SCENE =========== --><div id="scene-iframe-container" class="scene relative">
        <div id="iframe-url-display" class="absolute top-4 right-4 text-gray-500 text-xs z-10 p-2 bg-black/30 rounded-md">
            https://pwr.alphatek.no
        </div>
        <iframe id="test-iframe" src="https://pwr.alphatek.no" frameborder="0" loading="lazy"></iframe>
    </div>

    <!-- =========== FIREBASE SDK OG LOGIKK =========== --><script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyDFu-aEtJ17AxIk3B5AjB-BSZ1u0-hY9y4", authDomain: "prototypefitnessage.firebaseapp.com", projectId: "prototypefitnessage", storageBucket: "prototypefitnessage.appspot.com", messagingSenderId: "203645458759", appId: "1:203645458759:web:6c19ba323bbbafdd745462", databaseURL: "https://prototypefitnessage-default-rtdb.europe-west1.firebasedatabase.app" };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const ServerValue = firebase.database.ServerValue;
        const urlDisplay = document.getElementById('iframe-url-display');
        const adminAppUrl = "https://prototypefitnessage.web.app"; 
        const channelIdDisplayTop = document.getElementById('channel-id-display-top');

        function runApp(channelId, isFirstVisit) {
            console.log(`Running app with channel: ${channelId}. Is first visit: ${isFirstVisit}`);
            
            const channelRef = database.ref(`channels/${channelId}`);
            const kommandoRef = channelRef.child('kommando');
            const reportDataRef = channelRef.child('reportData');

            const initialUpdateData = { status: 'connected', lastUsed: ServerValue.TIMESTAMP };
            if (isFirstVisit) {
                console.log("Setter 'firstVisitTimestamp' i Firebase for denne kanalen.");
                initialUpdateData.firstVisitTimestamp = ServerValue.TIMESTAMP;
            }
            channelRef.update(initialUpdateData);

            const overviewVideo = document.getElementById('scene-1-video');
            if (overviewVideo) {
                overviewVideo.addEventListener('timeupdate', function() {
                    if (this.duration && (this.duration - this.currentTime) < 8) {
                        this.currentTime = 0; 
                        this.play().catch(e => console.warn("Autoplay blokkert:", e));
                    }
                });
            }

            const sceneIds = ["scene-iframe-container", "scene-0", "scene-1", "scene-2", "scene-countdown-1", "scene-go-1", "scene-iframe-container", "scene-6", "scene-countdown-bal-right", "scene-go-bal-right", "scene-iframe-container", "scene-10", "scene-countdown-2", "scene-go-2", "scene-iframe-container", "scene-14", "scene-countdown-3", "scene-go-3", "scene-iframe-container", "scene-18"];
            let currentSceneIndex = 0;
            let autoAdvanceTimer = null; 
            let reportAnimationTimers = []; 
        
            function showScene(index) {
                console.log(`showScene called with index: ${index} (${sceneIds[index]})`);
                if (index < 0 || index >= sceneIds.length) { console.error("Ugyldig sceneindeks:", index); return; }
                currentSceneIndex = index;
                const sceneIdToShow = sceneIds[currentSceneIndex];

                if (autoAdvanceTimer) { clearTimeout(autoAdvanceTimer); autoAdvanceTimer = null; }
                if (reportAnimationTimers.length > 0) { reportAnimationTimers.forEach(clearTimeout); reportAnimationTimers = []; }

                document.querySelectorAll('.scene').forEach(scene => {
                    const video = scene.querySelector('video');
                    if (scene.id === sceneIdToShow) {
                        scene.classList.add('active');
                        if (video) { if (video.id !== 'scene-1-video') { video.currentTime = 0; } video.play().catch(e => console.warn("Autoplay blokkert:", e)); }
                    } else {
                        scene.classList.remove('active');
                        if (video) { video.pause(); }
                    }
                });
                
                const iframe = document.getElementById('test-iframe');
                let newUrl = ""; 
                switch (sceneIdToShow) {
                    case "scene-2": case "scene-6": newUrl = "https://pwr.alphatek.no/cop"; break;
                    // ENDRING HER: URL oppdatert
                    case "scene-10": newUrl = "https://pwr.alphatek.no/jump-tia"; break;
                    case "scene-14": newUrl = "https://pwr.alphatek.no/pull"; break;
                    case "scene-0": case "scene-1": case "scene-18": newUrl = "https://pwr.alphatek.no"; break;
                }
                
                if (newUrl && iframe.src !== newUrl) { iframe.src = newUrl; urlDisplay.textContent = newUrl; }
                if (sceneIdToShow === 'scene-iframe-container') { urlDisplay.textContent = iframe.src; }
                if (sceneIdToShow.startsWith('scene-go-')) { autoAdvanceTimer = setTimeout(() => { showScene(index + 1); }, 1500); }

                if (sceneIdToShow === 'scene-18') { 
                    reportDataRef.once('value', (snapshot) => {
                        const data = snapshot.val() || {};
                        function updateAgeChange(boxId, ageKey, changeKey, defaultAge, defaultChange, defaultText) {
                            const ageEl = document.querySelector(`#${boxId} .text-5xl`);
                            const changeParentEl = document.querySelector(`#${boxId} .text-2xl`);
                            const changeSupEl = changeParentEl.querySelector('sup');
                            const textEl = document.getElementById(`report-text-${boxId.slice(-1)}`);
                            const age = data[ageKey] || defaultAge;
                            const changeVal = parseInt(data[changeKey] || defaultChange); 
                            ageEl.textContent = age;
                            changeSupEl.textContent = `(${changeVal > 0 ? '+' : ''}${changeVal})`;
                            textEl.textContent = data[`reportText${boxId.slice(-1)}`] || defaultText;
                            changeParentEl.classList.remove('text-green-400', 'text-red-400');
                            changeParentEl.classList.add(changeVal > 0 ? 'text-red-400' : 'text-green-400');
                        }
                        document.querySelector('#report-real-age span:last-child').textContent = data.realAge || '35';
                        document.querySelector('#report-new-age span:last-child').textContent = data.fitnessAge || '32';
                        updateAgeChange('report-box-1', 'balanceAge', 'balanceChange', '34', '-1', '1 year improvement');
                        updateAgeChange('report-box-2', 'functionalAge', 'functionalChange', '31', '-3', 'Excellent 3 year improvement');
                        updateAgeChange('report-box-3', 'strengthAge', 'strengthChange', '33', '+1', 'Needs focus (+1 year)');
                        document.querySelector('#report-final-message h2').textContent = data.finalMessage || 'You are 3 years younger!';
                        
                        const realAge = document.getElementById('report-real-age');
                        const newAge = document.getElementById('report-new-age');
                        const box1 = document.getElementById('report-box-1');
                        const box2 = document.getElementById('report-box-2');
                        const box3 = document.getElementById('report-box-3');
                        const text1 = document.getElementById('report-text-1'); 
                        const text2 = document.getElementById('report-text-2'); 
                        const text3 = document.getElementById('report-text-3'); 
                        const finalMessage = document.getElementById('report-final-message');
                        
                        [box1, box2, box3].forEach(box => { box.classList.add('opacity-0', 'translate-y-5'); });
                        [text1, text2, text3, finalMessage].forEach(text => { text.classList.add('opacity-0'); });
                        
                        realAge.style.transform = 'scale(1)'; realAge.style.opacity = '1';
                        newAge.style.transform = 'scale(0.7)'; newAge.style.opacity = '0';
                        newAge.classList.remove('animate-pulse-green-report');
                        
                        const timers = []; 
                        timers.push(setTimeout(() => { box1.classList.remove('opacity-0', 'translate-y-5'); }, 500)); 
                        timers.push(setTimeout(() => { box2.classList.remove('opacity-0', 'translate-y-5'); }, 1100)); 
                        timers.push(setTimeout(() => { box3.classList.remove('opacity-0', 'translate-y-5'); }, 1700)); 
                        timers.push(setTimeout(() => { text1.classList.remove('opacity-0'); }, 2000)); 
                        timers.push(setTimeout(() => { text2.classList.remove('opacity-0'); }, 2300)); 
                        timers.push(setTimeout(() => { text3.classList.remove('opacity-0'); }, 2600)); 
                        timers.push(setTimeout(() => { realAge.style.transform = 'scale(0.7)'; realAge.style.opacity = '0'; newAge.style.transform = 'scale(1.1)'; newAge.style.opacity = '1'; newAge.classList.add('animate-pulse-green-report'); }, 4600)); 
                        timers.push(setTimeout(() => { newAge.style.transform = 'scale(1)'; }, 5300)); 
                        timers.push(setTimeout(() => { finalMessage.classList.remove('opacity-0'); }, 6100)); 
                        reportAnimationTimers = timers; 
                    });
                }
            }

            let isInitialLoad = true;

            kommandoRef.on('value', (snapshot) => {
                const kommandoData = snapshot.val();
                console.log(`Mottok kommando-objekt på kanal ${channelId}:`, kommandoData);

                if (isInitialLoad) { isInitialLoad = false; return; }
                if (!kommandoData || !kommandoData.cmd) { console.log("Tom kommando mottatt."); return; }
                const kommando = kommandoData.cmd;
                
                // ENDRET: Ny kommando for dynamisk URL
                switch (kommando) {
                    case "showIframeWithUrl":
                        const newUrl = kommandoData.payload?.url;
                        if (newUrl) {
                            console.log(`Mottok kommando om å vise iframe med URL: ${newUrl}`);
                            const iframe = document.getElementById('test-iframe');
                            if (iframe.src !== newUrl) {
                                iframe.src = newUrl;
                            }
                            showScene(0); // Viser scene 0, som er iframe-containeren
                        } else {
                            console.warn("Mottok 'showIframeWithUrl' uten en gyldig URL i payload.");
                        }
                        break;
                    case "showIframeHome": showScene(0); break;
                    case "showScreensaver": showScene(1); break;
                    case "showOverview": showScene(2); break;
                    case "showBalanceLeft": showScene(3); break;
                    case "showCounter1": showScene(4); break;
                    case "showBalanceRight": showScene(7); break;
                    case "showCounterBalRight": showScene(8); break;
                    case "showJump": showScene(11); break;
                    case "showCounterJump": showScene(12); break;
                    case "showPull": showScene(15); break;
                    case "showCounterPull": showScene(16); break;
                    case "showReport": showScene(19); break;
                    case "showPwr1": showScene(6); break; 
                    case "showPwrBalRight": showScene(10); break; 
                    case "showPwr2": showScene(14); break; 
                    case "showPwr3": showScene(18); break; 
                }
            });
            
            document.getElementById('video-counter-1').onended = () => { showScene(5); };
            document.getElementById('video-counter-bal-right').onended = () => { showScene(9); };
            document.getElementById('video-counter-2').onended = () => { showScene(13); };
            document.getElementById('video-counter-3').onended = () => { showScene(17); };

            showScene(1);

        } // <-- SLUTT PÅ runApp

        function generateChannelId() { return Math.random().toString(36).substring(2, 8); }

        const firstVisitFlagKey = 'alphatek_display_first_visit';
        let isFirstVisit = localStorage.getItem(firstVisitFlagKey) === null;
        if (isFirstVisit) {
            localStorage.setItem(firstVisitFlagKey, new Date().toISOString());
        }

        const queryParams = new URLSearchParams(window.location.search);
        let channelId = queryParams.get('channel');

        if (!channelId) {
            channelId = generateChannelId();
            window.location.search = `?channel=${channelId}`;
        } else {
            channelIdDisplayTop.textContent = `ID: ${channelId.toUpperCase()}`;
            const magicLink = `${adminAppUrl}?channel=${channelId}`;

            try {
                const qrContainer = document.getElementById("dynamic-qr-code");
                if (typeof QRCode !== 'undefined' && qrContainer) {
                // ENDRING: Beregn størrelsen basert på indre bredde, ikke ytre, for å unngå overflow
                const style = window.getComputedStyle(qrContainer);
                const padding = parseFloat(style.paddingLeft) + parseFloat(style.paddingRight);
                const border = parseFloat(style.borderLeftWidth) + parseFloat(style.borderRightWidth);
                const innerWidth = qrContainer.clientWidth - padding - border;

                new QRCode(qrContainer, { text: magicLink, width: innerWidth, height: innerWidth, colorDark: "#000000", colorLight: "#ffffff", correctLevel: QRCode.CorrectLevel.H });
            } else {
                console.error("QR-kode generering feilet.");
            }
            } catch (error) {
                console.error("QR-kode krasjet:", error);
            }
            
            window.onload = () => {
                runApp(channelId, isFirstVisit);
            };
        }
    </script>

    <!-- NYTT INNHOLD: JAVASCRIPT FOR KARUSELL --><script>
    document.addEventListener('DOMContentLoaded', () => {
        const reportData = {
            'return-to-sport': {
                title: 'Return to Sport',
                explanation: 'Given high re-injury rates (~20-30%) post-rehab, this protocol provides a robust assessment of an athlete\'s readiness to return to play. It evaluates key performance markers from maximal plyometric capacity and limb stiffness to muscular endurance and stretch-shortening cycle (SSC) function. This data gives therapists objective insights to guide late-stage (Phase 3-4) training and track progression, minimizing the risk of re-injury.',
                tests: ['Countermovement Jump (CMJ)', 'Single-Leg CMJ', 'Reactive Strength Index (RSI)', 'Drop Jump', 'Lateral Stability']
            },
            'performance': {
                title: 'Performance Report',
                explanation: "This battery is designed to measure explosive power, reactivity, and maximal strength, crucial metrics for improving on-court performance, jump height, and sprint speed. It's intended for any athlete in any sport.",
                tests: ['IMTP', 'Countermovement Jump', 'Reactive Strength Index', 'Repetitive CMJ', 'Lateral Stability']
            },
            'shoulder-screening': {
                title: 'Athletic Shoulder (ASH) Test',
                explanation: 'The ASH test is a reliable and specific method for assessing isometric shoulder strength. It is used to map strength, symmetry, and weaknesses in the scapular stabilizers and glenoheral muscles, especially in athletes in sports like handball, swimming and volleyball. The test is ideal for injury prevention screening, monitoring rehabilitation progress, and making return-to-play decisions.',
                tests: ['Isometric Strength in Abduction (Y-Position)', 'Isometric Strength in Horizontal Abduction (T-Position)', 'External Rotation Strength', 'Internal Rotation Strength']
            },
            'rehab-initial': {
                title: 'Phase 1 & 2 Rehab',
                explanation: 'This protocol is designed for the early stages of rehabilitation. It utilizes gentle, low-load assessments like isometric strength and static balance tests. This allows therapists to safely monitor neuromuscular function and track progress from the very beginning of the recovery process without compromising healing tissue, providing a clear baseline for future comparison.',
                tests: ['Isometric Strength Test (e.g., IMTP)', 'Single-Leg Balance (Eyes open/closed)', 'Weight-Bearing Symmetry']
            },
            /* NYTT OBJEKT LAGT TIL */
            'senior-wellness': {
                title: 'Senior Fitness Test',
                explanation: 'Intended for people over 60, its main focus is to test key characteristics to assess fall risk. This test measures balance, strength, and function, three crucial abilities to stay safe and avoid falls. Training these abilities has been shown to help the elderly maintain their physical independence. Your result is compared with others aged 65 to 83.',
                tests: ['4 Balance Tests (Feet together, One foot, etc.)', '3 Function Tests (Jump, Squat Depth/Speed)', '4 Strength Tests (Pushups, IMTP, etc.)']
            }
        };

        const reportModalOverlay = document.getElementById('report-modal-overlay');
        const reportCards = document.querySelectorAll('.report-card');
        const modalImage = document.getElementById('modal-report-image');
        const modalTitle = document.getElementById('modal-report-title');
        const modalExplanation = document.getElementById('modal-report-explanation');
        const modalTestList = document.getElementById('modal-report-tests');
        const closeReportModalBtn = document.querySelector('.close-report-modal');

        function openReportModal(reportId) {
            const data = reportData[reportId];
            if (!data) return;
            const clickedCard = document.querySelector(`.report-card[data-report-id="${reportId}"]`);
            if (!clickedCard) return; // Sikkerhetssjekk
            const imgSrc = clickedCard.querySelector('img').src;
            
            if (modalImage) modalImage.src = imgSrc;
            if (modalImage) modalImage.alt = data.title;
            if (modalTitle) modalTitle.textContent = data.title;
            if (modalExplanation) modalExplanation.textContent = data.explanation;
            
            if (modalTestList) {
                modalTestList.innerHTML = '';
                data.tests.forEach(test => {
                    const li = document.createElement('li');
                    li.textContent = test;
                    modalTestList.appendChild(li);
                });
            }
            
            document.body.classList.add('modal-open');
            if (reportModalOverlay) reportModalOverlay.classList.add('is-visible');
        }

        function closeReportModal() {
            if (!reportModalOverlay) return;
            document.body.classList.remove('modal-open');
            reportModalOverlay.classList.remove('is-visible');
        }

        reportCards.forEach(card => {
            card.addEventListener('click', () => {
                const reportId = card.dataset.reportId;
                openReportModal(reportId);
            });
        });

        if (closeReportModalBtn) {
            closeReportModalBtn.addEventListener('click', closeReportModal);
        }
        if (reportModalOverlay) {
            reportModalOverlay.addEventListener('click', (e) => {
                if (e.target === reportModalOverlay) {
                    closeReportModal();
                }
            });
        }
        
        document.addEventListener('keydown', (e) => {
            if (e.key === "Escape" && reportModalOverlay && reportModalOverlay.classList.contains('is-visible')) {
                closeReportModal();
            }
        });
    });
    </script>
</body>
</html>
